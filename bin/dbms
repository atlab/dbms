#! /bin/sh

app="$0"
scr="${app##*/}"
dir="${app%/*}"
lib="${dir}/../lib"

usage_exit() {
	echo "usage: $scr cmd <args>";
	echo "  where 'cmd' is one of:";
	echo "    start [id]";
	echo "    stop [id]";
	echo "    report [id]";
	echo "    shell [id]";
	echo "    admin [id]";
	exit 0;
}

libcmd() {
	cmd=$1; shift --;
	. $lib/$cmd;
	$cmd $*;
}

if [ "$#" -lt "1" ]; then
	usage_exit;
fi

verb=$1
server=$2; # todo: rework so servrer is not required but available fn
shift;
shift;

case $server in
	# todo: parse my_print_defaults mysqld_multi -s
	"1") socket=/var/run/mysqld/mysqld1.sock;;
	"2") socket=/var/run/mysqld/mysqld2.sock;;
esac

case $verb in
	"start") exec mysqld_multi start $server;;
	"stop") exec mysqld_multi stop $server;;
	"report") exec mysqld_multi report $server;; 
	"shell") exec mysql -u root -S $socket $*;;
	"admin") exec mysqladmin -u root -S $socket $*;;
	*) usage_exit;;
esac

